<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Handmade Wonders | Order Now</title>
    <link href="https://fonts.googleapis.com/css2?family=Quicksand:wght@400;600&display=swap" rel="stylesheet">
    
    <style>
        body { font-family: 'Quicksand', sans-serif; padding: 20px; max-width: 500px; margin: auto; background: #FDF0F0; color: #5F5F5F; }
        .page { display: none; background: white; padding: 30px; border-radius: 30px; box-shadow: 0 10px 25px rgba(255, 183, 178, 0.2); }
        .active { display: block; animation: fadeIn 0.5s; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        
        h2 { color: #FFB7B2; text-align: center; }
        input { width: 100%; padding: 12px; margin: 10px 0; border: 2px solid #FDF0F0; border-radius: 15px; box-sizing: border-box; }
        button { width: 100%; padding: 15px; margin: 10px 0; background: #FFB7B2; color: white; border: none; border-radius: 15px; font-weight: 600; cursor: pointer; transition: 0.3s; }
        button:hover { background: #ff9e97; transform: translateY(-2px); }
        
        .item { display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid #FDF0F0; padding: 15px 0; }
        .prod-info { display: flex; align-items: center; }
        .prod-img { 
            width: 60px; height: 60px; border-radius: 12px; 
            margin-right: 15px; object-fit: cover; background: #eee; 
            cursor: zoom-in;
        }

        .price-footer { 
            background: #FFF; border-top: 2px solid #FDF0F0; 
            padding: 15px; position: sticky; bottom: -30px; 
            margin: 20px -30px -30px -30px; border-radius: 0 0 30px 30px;
            display: flex; justify-content: space-between; align-items: center;
        }
        .total-amount { color: #FFB7B2; font-weight: 600; font-size: 1.2em; }
        
        .error-text { color: #ff8b84; font-size: 0.8em; display: none; margin-top: -5px; }
    </style>
</head>
<body>

    <div id="page1" class="page active">
        <h2>Your Details</h2>
        <input type="text" id="custName" placeholder="Full Name">
        <input type="text" id="custId" placeholder="ID (202XXXXXXXXXG)">
        <div id="custIdError" class="error-text">Invalid ID format.</div>
        <input type="tel" id="custPhone" placeholder="10-Digit Phone">
        <div id="custPhoneError" class="error-text">Invalid Phone Number.</div>
        <button onclick="validatePage1()">Next: Shop Collection</button>
    </div>

    <div id="page2" class="page">
        <h2>Our Collection</h2>
        <p>Click images to view details</p>

        <div class="item">
            <div class="prod-info">
                <img src="images/placeholder.jpg" class="prod-img" onclick="openGallery(this.src)">
                <span><strong>Daisy Bracelet</strong><br><small>₹150</small></span>
            </div>
            <input type="checkbox" class="product" value="Daisy Bracelet (₹150)" data-price="150" onchange="updateTotal()">
        </div>

        <div class="item">
            <div class="prod-info">
                <img src="images/placeholder.jpg" class="prod-img" onclick="openGallery(this.src)">
                <span><strong>Crochet Bee</strong><br><small>₹250</small></span>
            </div>
            <input type="checkbox" class="product" value="Crochet Bee (₹250)" data-price="250" onchange="updateTotal()">
        </div>

        <div class="item">
            <div class="prod-info">
                <img src="images/placeholder.jpg" class="prod-img" onclick="openGallery(this.src)">
                <span><strong>Pastel Charm</strong><br><small>₹120</small></span>
            </div>
            <input type="checkbox" class="product" value="Pastel Charm (₹120)" data-price="120" onchange="updateTotal()">
        </div>

        <div class="price-footer">
            <span>Items Selected</span>
            <span class="total-amount">Total: ₹<span id="liveTotal">0</span></span>
        </div>

        <button onclick="validatePage2()">Next: Delivery</button>
        <button onclick="nextPage(1)" style="background:#B2CEFE">Back</button>
    </div>

    <div id="page3" class="page">
        <h2>Delivery Info</h2>
        <input type="text" id="recName" placeholder="Recipient Name">
        <input type="text" id="recId" placeholder="Recipient ID/Room (202...G)">
        <div id="recIdError" class="error-text">Invalid ID format.</div>
        <input type="tel" id="recPhone" placeholder="Recipient Phone">
        <div id="recPhoneError" class="error-text">Invalid Phone Number.</div>
        <button id="confirmBtn" onclick="validateAndSubmit()">Confirm Order</button>
        <button onclick="nextPage(2)" style="background:#B2CEFE">Back</button>
    </div>

    <div id="success" class="page">
        <div style="text-align: center;">
            <h2 style="color: #B2CEFE;">Order Placed!</h2>
            <p>Thank you for placing order!</p>
            <button onclick="location.reload()">New Order</button>
        </div>
    </div>

    <script>
        const SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbwllzgyizcL7TgocbOjO4L5umqAosWOe8tc_f8zycIbcJhnB6Q1KN0m51dr_jIgSZBi8w/exec';
        const idRegex = /^202[a-zA-Z0-9]{9}G$/i; 
        const phoneRegex = /^[0-9]{10}$/;

        function nextPage(pageNo) {
            document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
            document.getElementById('page' + pageNo).classList.add('active');
        }

        function updateTotal() {
            let total = 0;
            const selected = document.querySelectorAll('.product:checked');
            selected.forEach(item => {
                total += parseInt(item.getAttribute('data-price'));
            });
            document.getElementById('liveTotal').innerText = total;
        }

        function openGallery(src) {
            if(src.includes('placeholder')) {
                alert("Image gallery will open here once you add your photos!");
            } else {
                window.open(src, '_blank'); 
            }
        }

        function validatePage1() {
            const id = document.getElementById('custId').value;
            const phone = document.getElementById('custPhone').value;
            let ok = true;
            if(!idRegex.test(id)) { document.getElementById('custIdError').style.display='block'; ok=false; }
            if(!phoneRegex.test(phone)) { document.getElementById('custPhoneError').style.display='block'; ok=false; }
            if(ok) nextPage(2);
        }

        function validatePage2() {
            if(document.querySelectorAll('.product:checked').length > 0) nextPage(3);
            else alert("Please select at least one item!");
        }

        function validateAndSubmit() {
            const id = document.getElementById('recId').value;
            const phone = document.getElementById('recPhone').value;
            if(idRegex.test(id) && phoneRegex.test(phone)) submitOrder();
            else alert("Please check delivery details!");
        }

        async function submitOrder() {
            const btn = document.getElementById('confirmBtn');
            btn.innerText = "Sending...";
            btn.disabled = true;

            const selected = Array.from(document.querySelectorAll('.product:checked')).map(p => p.value).join(", ");
            const data = {
                name: document.getElementById('custName').value,
                id: document.getElementById('custId').value,
                phone: document.getElementById('custPhone').value,
                items: selected + " | Total: ₹" + document.getElementById('liveTotal').innerText,
                rName: document.getElementById('recName').value,
                rId: document.getElementById('recId').value,
                rPhone: document.getElementById('recPhone').value
            };

            try {
                await fetch(SCRIPT_URL, { method: 'POST', mode: 'no-cors', body: JSON.stringify(data) });
            } finally {
                document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
                document.getElementById('success').classList.add('active');
            }
        }
    </script>
</body>
</html>